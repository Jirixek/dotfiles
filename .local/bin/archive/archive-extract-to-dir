#!/bin/sh


for file in "$@"; do
	(
	NEWDIR="$(basename "$file" | sed -E 's/\..+//')"
	mkdir "$NEWDIR" || { echo "Error: cannot create '$NEWDIR'" >&2; exit 1; }
	cd "$NEWDIR" || { echo "Error: cannot enter '$NEWDIR'" >&2; exit 1; }

	if ! archive-extract-here "$file"
	then
		cd .. || { echo "Error: cannot leave '$NEWDIR'" >&2; exit 1; }
		rm -rf "$NEWDIR" || { echo "Error: cannot remove $NEWDIR" >&2; exit 1; }
	fi
	) || exit
done
